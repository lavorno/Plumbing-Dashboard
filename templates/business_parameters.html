{% extends "base.html" %}

{% block content %}
<div class="container my-4">
    <div class="card bg-dark text-white">
        <div class="card-body">
            <h5 class="card-title text-purple mb-4">
                <i class="fas fa-cogs"></i> Business Parameters
            </h5>
            
            <div class="expense-group">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Efficiency Rate (%)</label>
                            <input type="number" class="form-control" id="efficiencyRate" 
                                   min="0" max="100" step="1" required>
                            <small class="text-muted">Percentage of available hours that are billable</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Profit Margin (%)</label>
                            <input type="number" class="form-control" id="profitMargin" 
                                   min="0" max="100" step="1" required>
                            <small class="text-muted">Target profit margin percentage</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.expense-group {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid rgba(167, 139, 250, 0.2);
}

.expense-group:hover {
    border-color: rgba(167, 139, 250, 0.5);
}

.form-control {
    background: var(--dark-bg) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    color: white !important;
}

.form-control:focus {
    border-color: #a78bfa !important;
    box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.25) !important;
}

.form-label {
    color: #a78bfa;
    font-weight: 500;
}
</style>

{% block scripts %}
<script>
function loadBusinessParameters() {
    fetch('/get_settings')
        .then(response => response.json())
        .then(data => {
            const params = data.business_parameters;
            document.getElementById('efficiencyRate').value = (params.efficiency_rate * 100).toFixed(0);
            document.getElementById('profitMargin').value = ((1 - params.profit_margin_multiplier) * 100).toFixed(0);
        });
}

function updateBusinessParameters() {
    const efficiencyRate = parseFloat(document.getElementById('efficiencyRate').value) / 100;
    const profitMargin = parseFloat(document.getElementById('profitMargin').value);
    
    fetch('/update_business_parameters', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            efficiency_rate: efficiencyRate,
            profit_margin: profitMargin
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('Parameters updated');
        } else {
            showNotification('Failed to update parameters', 'error');
        }
    })
    .catch(error => {
        showNotification('Failed to update parameters', 'error');
    });
}

// Add event listeners
document.addEventListener('DOMContentLoaded', loadBusinessParameters);

// Update parameters when input values change
document.getElementById('efficiencyRate').addEventListener('change', updateBusinessParameters);
document.getElementById('profitMargin').addEventListener('change', updateBusinessParameters);
</script>
{% endblock %}
{% endblock %} 